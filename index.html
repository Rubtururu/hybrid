<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SmartStakingBNB PRO Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Inter,Arial;background:#0b0f14;color:#e5e7eb}
header{padding:20px;background:#111827;display:flex;justify-content:space-between;align-items:center}
button{background:#2563eb;border:none;color:white;padding:10px 16px;border-radius:10px;cursor:pointer;margin-top:6px}
button.secondary{background:#374151}
button:disabled{opacity:.5}
section{padding:20px}
.card{background:#111827;border-radius:18px;padding:20px;margin-bottom:20px;box-shadow:0 0 20px rgba(0,0,0,.45)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}
h2{margin-top:0}
.list{max-height:260px;overflow:auto}
.row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #1f2937;font-size:14px}
.rank1{color:#facc15}.rank2{color:#d1d5db}.rank3{color:#c084fc}
.badge{background:#1f2937;border-radius:8px;padding:2px 8px;font-size:12px}
.countdown{font-weight:bold}
.fade{animation:fade .6s}
@keyframes fade{from{opacity:0}to{opacity:1}}
</style>
</head>
<body>
<header>
<h1>SmartStakingBNB PRO</h1>
<div>
<span id="wallet">Not connected</span>
<button onclick="connect()">Connect</button>
</div>
</header>

<section class="grid">
<div class="card">
<h2>üî• Subasta Activa</h2>
<div>Pool: <b><span id="auctionPool">-</span> BNB</b></div>
<div>Puja actual: <b><span id="auctionBid">-</span> BNB</b></div>
<div>Finaliza en: <span id="auctionTimer" class="countdown">-</span></div>
<button onclick="bid()">Pujar +0.001 BNB</button>
</div>

<div class="card">
<h2>üèÜ Top 10 Pujadores</h2>
<div id="topBidders" class="list"></div>
</div>
</section>

<section class="grid">
<div class="card">
<h2>üéüÔ∏è Rifa Horaria</h2>
<div>Pool: <span id="hourlyPool">-</span> BNB</div>
<div>Finaliza en: <span id="hourlyTimer" class="countdown">-</span></div>
<input id="hourlyTickets" type="number" placeholder="Tickets" />
<button onclick="enterRaffle(false)">Entrar</button>
<div class="list" id="hourlyPlayers"></div>
</div>

<div class="card">
<h2>üéüÔ∏è Rifa Diaria</h2>
<div>Pool: <span id="dailyPool">-</span> BNB</div>
<div>Finaliza en: <span id="dailyTimer" class="countdown">-</span></div>
<input id="dailyTickets" type="number" placeholder="Tickets" />
<button onclick="enterRaffle(true)">Entrar</button>
<div class="list" id="dailyPlayers"></div>
</div>
</section>

<section class="grid">
<div class="card">
<h2>üë§ Mi Perfil</h2>
<div>Premios totales: <b><span id="myRewards">-</span> BNB</b></div>
<div>Subastas ganadas: <span id="myAuctions">-</span></div>
<div>Rifas ganadas: <span id="myRaffles">-</span></div>
<button class="secondary" onclick="withdrawUserRewards()">Withdraw (Owner)</button>
</div>

<div class="card">
<h2>üìä Estad√≠sticas Globales</h2>
<div>Total pujas: <span id="totalBids">-</span></div>
<div>Total subastas: <span id="totalAuctions">-</span></div>
<div>Total rifas: <span id="totalRaffles">-</span></div>
<div>Total BNB repartido: <span id="totalBNB">-</span></div>
<canvas id="statsChart" height="120"></canvas>
</div>
</section>

<script>
const CONTRACT = "0x946409c61E622c6A007D47913C48A2B888F43d7C";
const ABI = [{"inputs":[{"internalType":"address","name":"_treasury","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"pool","type":"uint256"}],"name":"AuctionClosed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint8","name":"rank","type":"uint8"}],"name":"AuctionReward","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"BidPlaced","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bool","name":"daily","type":"bool"},{"indexed":false,"internalType":"uint256","name":"pool","type":"uint256"}],"name":"RaffleClosed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"tickets","type":"uint256"},{"indexed":false,"internalType":"bool","name":"daily","type":"bool"}],"name":"RaffleEntered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"bool","name":"daily","type":"bool"}],"name":"RaffleReward","type":"event"},{"inputs":[],"name":"AUCTION_INCREMENT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"AUCTION_REWARDS","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"RAFFLE_DAILY_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"RAFFLE_HOURLY_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"auction","outputs":[{"internalType":"uint256","name":"prizePool","type":"uint256"},{"internalType":"uint256","name":"currentBid","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"auctionWinners","outputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint8","name":"rank","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"auctionsWon","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"bid","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"closeAuction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"daily","type":"bool"}],"name":"closeRaffle","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"dailyPlayers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"dailyTickets","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tickets","type":"uint256"},{"internalType":"bool","name":"daily","type":"bool"}],"name":"enterRaffle","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"hourlyPlayers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"hourlyTickets","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleDaily","outputs":[{"internalType":"bool","name":"daily","type":"bool"},{"internalType":"uint256","name":"prizePool","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"raffleDailyWinners","outputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint8","name":"rank","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleHourly","outputs":[{"internalType":"bool","name":"daily","type":"bool"},{"internalType":"uint256","name":"prizePool","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"raffleHourlyWinners","outputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint8","name":"rank","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"rafflesWon","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_t","type":"address"}],"name":"setTreasury","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"topBidders","outputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalAuctions","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBNBRepartido","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBids","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalRaffles","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalUserRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"treasury","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdrawTreasury","outputs":[],"stateMutability":"nonpayable","type":"function"}];
let web3, account, contract;

async function connect(){
 if(!window.ethereum) return alert('Instala Metamask');
 web3 = new Web3(window.ethereum);
 await ethereum.request({method:'eth_requestAccounts'});
 account = (await web3.eth.getAccounts())[0];
 wallet.innerText = account;
 contract = new web3.eth.Contract(ABI, CONTRACT);
 loadAll(); listenEvents();
}

async function bid(){
 const inc = await contract.methods.AUCTION_INCREMENT().call();
 await contract.methods.bid().send({from:account,value:inc});
}

async function enterRaffle(daily){
 const t = daily ? dailyTickets.value : hourlyTickets.value;
 await contract.methods.enterRaffle(t,daily).send({from:account,value:web3.utils.toWei((0.001*t).toString())});
}

async function withdrawUserRewards(){
 await contract.methods.withdrawUserRewards().send({from:account});
}

async function loadAll(){
 loadAuction();loadRaffles();loadProfile();loadStats();
}

async function loadAuction(){
 const a = await contract.methods.auction().call();
 auctionPool.innerText = web3.utils.fromWei(a.prizePool);
 auctionBid.innerText = web3.utils.fromWei(a.currentBid);
 timer(a.endTime, auctionTimer);
 topBidders.innerHTML='';
 const rewards=[25,18,13,10,8,6,5,4,3,2];
 for(let i=0;i<10;i++){
  try{
   const b=await contract.methods.topBidders(i).call();
   if(b.user==='0x0000000000000000000000000000000000000000')break;
   const prize=(a.prizePool*rewards[i]/100).toFixed(4);
   topBidders.innerHTML+=`<div class='row rank${i+1} fade'>#${i+1} ${b.user.slice(0,6)}...<span>${web3.utils.fromWei(b.amount)} BNB ¬∑ <span class='badge'>${prize} BNB</span></span></div>`;
  }catch{}
 }
}

async function loadRaffles(){
 const h=await contract.methods.raffleHourly().call();
 hourlyPool.innerText=web3.utils.fromWei(h.prizePool);
 timer(h.endTime,hourlyTimer);
 const d=await contract.methods.raffleDaily().call();
 dailyPool.innerText=web3.utils.fromWei(d.prizePool);
 timer(d.endTime,dailyTimer);
}

async function loadStats(){
 const bids=await contract.methods.totalBids().call();
 const auctions=await contract.methods.totalAuctions().call();
 const raffles=await contract.methods.totalRaffles().call();
 const bnb=web3.utils.fromWei(await contract.methods.totalBNBRepartido().call());
 totalBids.innerText=bids; totalAuctions.innerText=auctions; totalRaffles.innerText=raffles; totalBNB.innerText=bnb;
 new Chart(statsChart,{type:'bar',data:{labels:['Bids','Auctions','Raffles'],datasets:[{data:[bids,auctions,raffles]}]}});
}

async function loadProfile(){
 myRewards.innerText=web3.utils.fromWei(await contract.methods.totalUserRewards(account).call());
 myAuctions.innerText=await contract.methods.auctionsWon(account).call();
 myRaffles.innerText=await contract.methods.rafflesWon(account).call();
}

function timer(end,el){
 const i=setInterval(()=>{
  const s=end-Math.floor(Date.now()/1000);
  if(s<=0){el.innerText='Finalizado';clearInterval(i);return;}
  el.innerText=Math.floor(s/60)+'m '+s%60+'s';
 },1000);
}

function listenEvents(){
 contract.events.BidPlaced().on('data',loadAuction);
 contract.events.AuctionReward().on('data',loadAuction);
 contract.events.RaffleReward().on('data',loadRaffles);
}
</script>
</body>
</html>
