<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hybrid Raffle & Staking Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.min.js"></script>
<style>
  body { font-family: 'Arial', sans-serif; background: #0e0e0e; color: #f5f5f5; margin:0; padding:0; }
  header { padding: 1rem; background: linear-gradient(90deg,#ff6a00,#ee0979); text-align:center; font-size:1.5rem; font-weight:bold; }
  .container { max-width: 1000px; margin:auto; padding:2rem; display:grid; grid-template-columns:1fr 1fr; gap:2rem; }
  .card { background:#1e1e1e; padding:1rem; border-radius:12px; box-shadow:0 0 20px rgba(255,0,150,0.3); transition: transform 0.3s;}
  .card:hover { transform: translateY(-5px); }
  button { padding:0.6rem 1rem; background:#ff3c6e; border:none; border-radius:8px; color:white; cursor:pointer; font-weight:bold; transition: 0.2s;}
  button:hover { background:#ff1a4d; }
  select,input { padding:0.5rem; border-radius:6px; border:none; margin-right:0.5rem; width:100px;}
  h2 { color:#ff6a00; margin-top:0;}
  .stat { font-size:1.2rem; margin-bottom:0.5rem; }
  .section { margin-bottom:2rem; }
  .countdown { font-weight:bold; color:#00ffcc; }
  .ticket-list, .raffle-list, .auction-list, .stake-list { max-height:150px; overflow-y:auto; margin-top:1rem; }
</style>
</head>
<body>
<header>Hybrid Raffle & Staking Dashboard</header>

<div class="container">

  <!-- Conexión Wallet -->
  <div class="card section">
    <h2>Wallet</h2>
    <button id="connectWalletBtn">Conectar Wallet</button>
    <p>Dirección: <span id="userAddress">No conectado</span></p>
  </div>

  <!-- Dashboard Global -->
  <div class="card section">
    <h2>Estadísticas Globales</h2>
    <p class="stat">Total BNB Recaudado: <span id="totalBNB">0</span></p>
    <p class="stat">Total Tickets Vendidos: <span id="totalTickets">0</span></p>
    <p class="stat">Total Usuarios: <span id="totalUsers">0</span></p>
    <p class="stat">Total Staked: <span id="totalStaked">0</span></p>
    <p class="stat">BNB Repartido Rifas: <span id="totalRaffle">0</span></p>
  </div>

  <!-- Comprar Tickets -->
  <div class="card section">
    <h2>Comprar Tickets</h2>
    <select id="ticketPack">
      <option value="1">1 Ticket</option>
      <option value="5">5 Tickets</option>
      <option value="10">10 Tickets</option>
    </select>
    <button onclick="buyTickets()">Comprar</button>
    <div class="ticket-list" id="ticketList"></div>
  </div>

  <!-- Usar Tickets -->
  <div class="card section">
    <h2>Usar Tickets</h2>
    <input type="number" id="useTicketsAmount" placeholder="Cantidad"/>
    <button onclick="useTickets()">Usar</button>
  </div>

  <!-- Rifas -->
  <div class="card section">
    <h2>Rifa Horaria</h2>
    <p>Premio: <span id="hourlyPrize">0</span> BNB</p>
    <p>Finaliza en: <span class="countdown" id="hourlyCountdown">--:--:--</span></p>
    <div class="raffle-list" id="hourlyRaffleList"></div>
  </div>

  <div class="card section">
    <h2>Rifa Diaria</h2>
    <p>Premio: <span id="dailyPrize">0</span> BNB</p>
    <p>Finaliza en: <span class="countdown" id="dailyCountdown">--:--:--</span></p>
    <div class="raffle-list" id="dailyRaffleList"></div>
  </div>

  <!-- Subasta -->
  <div class="card section">
    <h2>Subasta</h2>
    <p>Última oferta: <span id="lastBid">0</span> BNB</p>
    <p>Finaliza en: <span class="countdown" id="auctionCountdown">--:--:--</span></p>
    <input type="number" id="bidAmount" placeholder="BNB"/>
    <button onclick="placeBid()">Ofertar</button>
    <div class="auction-list" id="auctionList"></div>
  </div>

  <!-- Staking -->
  <div class="card section">
    <h2>Staking</h2>
    <p>BNB Staked: <span id="userStaked">0</span></p>
    <p>Recompensas: <span id="userRewards">0</span></p>
    <input type="number" id="stakeAmount" placeholder="BNB"/>
    <button onclick="stakeBNB()">Stake</button>
    <button onclick="withdrawStake()">Retirar</button>
    <button onclick="claimRewards()">Claim</button>
  </div>

</div>

<script>
let provider, signer, contract;
const CONTRACT_ADDRESS = "0x1A7555635e049631744AD31Ca7b55CD439F3D7B9";
const ABI = [{"inputs":[{"internalType":"address","name":"_treasury","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"AUCTION_INCREMENT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"AUCTION_START","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"FEE_OWNER","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"FEE_TREASURY","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"STAKE_UNIT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TICKET_1","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TICKET_10","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TICKET_5","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"auction","outputs":[{"internalType":"uint256","name":"prize","type":"uint256"},{"internalType":"uint256","name":"currentBid","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"auctionHistory","outputs":[{"internalType":"uint256","name":"prize","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"bid","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"bnbGanadoRifas","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"bnbGanadoSubastas","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint8","name":"pack","type":"uint8"}],"name":"buyTickets","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"closeAuction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"daily","type":"bool"}],"name":"closeRaffle","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"knownUser","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastStakeClaim","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"pendingWithdraw","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleDaily","outputs":[{"internalType":"bool","name":"isDaily","type":"bool"},{"internalType":"uint256","name":"prize","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"raffleHistory","outputs":[{"internalType":"uint256","name":"prize","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleHourly","outputs":[{"internalType":"bool","name":"isDaily","type":"bool"},{"internalType":"uint256","name":"prize","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"stake","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"stakedBNB","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"stakingFeesPaid","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"ticketsComprados","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"ticketsGastados","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"ticketsStaking","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBNBRecaudado","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBNBRepartidoRifas","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBNBRepartidoSubastas","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBNBStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalTicketsVendidos","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalUsuarios","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"treasury","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bool","name":"daily","type":"bool"}],"name":"useTickets","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}];

async function connectWallet() {
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = await provider.getSigner();
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
  const address = await signer.getAddress();
  document.getElementById("userAddress").innerText = address;
  loadDashboard();
}

async function loadDashboard() {
  if(!contract) return;
  // Ejemplo de lectura de stats
  const totalBNB = await contract.totalBNB(); // adaptar según variable real
  document.getElementById("totalBNB").innerText = ethers.formatEther(totalBNB);
  const totalTickets = await contract.totalTickets();
  document.getElementById("totalTickets").innerText = totalTickets.toString();
}

async function buyTickets() {
  const pack = document.getElementById("ticketPack").value;
  const tx = await contract.buyTickets(pack, { value: ethers.parseEther("0.01") }); // ajustar precio
  await tx.wait();
  alert("Tickets comprados!");
  loadDashboard();
}

async function useTickets() {
  const amount = document.getElementById("useTicketsAmount").value;
  const tx = await contract.useTickets(amount);
  await tx.wait();
  alert("Tickets usados!");
}

async function placeBid() {
  const amount = document.getElementById("bidAmount").value;
  const tx = await contract.bid({ value: ethers.parseEther(amount) });
  await tx.wait();
  alert("Oferta enviada!");
}

async function stakeBNB() {
  const amount = document.getElementById("stakeAmount").value;
  const tx = await contract.stake({ value: ethers.parseEther(amount) });
  await tx.wait();
  alert("BNB staked!");
}

async function withdrawStake() {
  const tx = await contract.withdraw();
  await tx.wait();
  alert("Stake retirado!");
}

async function claimRewards() {
  const tx = await contract.claimRewards();
  await tx.wait();
  alert("Recompensas reclamadas!");
}

document.getElementById("connectWalletBtn").onclick = connectWallet;
</script>

</body>
</html>
