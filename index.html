<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>SmartStakingBNB PRO</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.1/dist/web3.min.js"></script>
<style>
body{margin:0;background:#0b0b0b;color:#eee;font-family:Inter,Arial}
header{padding:16px;text-align:center;font-size:24px;font-weight:700;background:linear-gradient(90deg,#ff6a00,#ee0979)}
button{background:#ff3366;border:none;color:white;padding:8px 14px;border-radius:10px;font-weight:700;cursor:pointer}
button:hover{background:#ff114d}
input{padding:7px;border-radius:8px;border:none}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;padding:20px}
.card{background:#141414;border-radius:16px;padding:16px;box-shadow:0 0 20px rgba(255,0,120,.25)}
.list{background:#0d0d0d;border-radius:10px;padding:8px;max-height:260px;overflow:auto;font-size:14px}
.count{color:#00ffd5;font-weight:700}
.gold{color:#ffd700}
.silver{color:#cfd8dc}
.bronze{color:#cd7f32}
.small{font-size:13px;opacity:.75}
</style>
</head>
<body>
<header>SmartStakingBNB PRO</header>

<div style="padding:16px">
<button id="connect">Conectar Wallet</button>
<div id="addr" class="small"></div>
</div>

<div class="grid">

<div class="card">
<h2>üî• Subasta Activa</h2>
<div>Premio acumulado: <b><span id="aucPool">0</span> BNB</b></div>
<div>Puja actual: <b><span id="aucBid">0</span> BNB</b></div>
<div>Finaliza en: <span id="aucTime" class="count"></span></div>
<button onclick="bid()">Pujar autom√°ticamente (+0.001 BNB)</button>
<h3>üèÜ TOP 10 PUJAS</h3>
<div id="bidList" class="list"></div>
</div>

<div class="card">
<h2>üìú √öltima Subasta</h2>
<div id="auctionHistory" class="list"></div>
</div>

<div class="card">
<h2>‚è±Ô∏è Rifa Horaria</h2>
<div>Pool: <b><span id="hPool">0</span> BNB</b></div>
<div>Finaliza en: <span id="hTime" class="count"></span></div>
<h4>Participantes</h4>
<div id="hPlayers" class="list"></div>
<h4>Ganadores</h4>
<div id="hWinners" class="list"></div>
</div>

<div class="card">
<h2>üåô Rifa Diaria</h2>
<div>Pool: <b><span id="dPool">0</span> BNB</b></div>
<div>Finaliza en: <span id="dTime" class="count"></span></div>
<h4>Participantes</h4>
<div id="dPlayers" class="list"></div>
<h4>Ganadores</h4>
<div id="dWinners" class="list"></div>
</div>

<div class="card">
<h2>üìä Estad√≠sticas Globales</h2>
<div>Total subastas: <span id="statAuctions"></span></div>
<div>Total rifas: <span id="statRaffles"></span></div>
<div>Total BNB repartido: <span id="statBNB"></span></div>
</div>

</div>

<script>
const CONTRACT='0x946409c61E622c6A007D47913C48A2B888F43d7C';
const ABI = [{"inputs":[{"internalType":"address","name":"_treasury","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"pool","type":"uint256"}],"name":"AuctionClosed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint8","name":"rank","type":"uint8"}],"name":"AuctionReward","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"BidPlaced","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bool","name":"daily","type":"bool"},{"indexed":false,"internalType":"uint256","name":"pool","type":"uint256"}],"name":"RaffleClosed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"tickets","type":"uint256"},{"indexed":false,"internalType":"bool","name":"daily","type":"bool"}],"name":"RaffleEntered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"bool","name":"daily","type":"bool"}],"name":"RaffleReward","type":"event"},{"inputs":[],"name":"AUCTION_INCREMENT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"AUCTION_REWARDS","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"RAFFLE_DAILY_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"RAFFLE_HOURLY_DURATION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"auction","outputs":[{"internalType":"uint256","name":"prizePool","type":"uint256"},{"internalType":"uint256","name":"currentBid","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"},{"internalType":"bool","name":"active","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"auctionWinners","outputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint8","name":"rank","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"auctionsWon","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"bid","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"closeAuction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"daily","type":"bool"}],"name":"closeRaffle","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"dailyPlayers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"dailyTickets","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tickets","type":"uint256"},{"internalType":"bool","name":"daily","type":"bool"}],"name":"enterRaffle","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"hourlyPlayers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"hourlyTickets","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleDaily","outputs":[{"internalType":"bool","name":"daily","type":"bool"},{"internalType":"uint256","name":"prizePool","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"raffleDailyWinners","outputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint8","name":"rank","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"raffleHourly","outputs":[{"internalType":"bool","name":"daily","type":"bool"},{"internalType":"uint256","name":"prizePool","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"raffleHourlyWinners","outputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint8","name":"rank","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"rafflesWon","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_t","type":"address"}],"name":"setTreasury","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"topBidders","outputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalAuctions","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBNBRepartido","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBids","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalRaffles","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalUserRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"treasury","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdrawTreasury","outputs":[],"stateMutability":"nonpayable","type":"function"}];

let web3,c,user;

const bidListEl = document.getElementById('bidList');

// ================= CONNECT =================
document.getElementById('connect').onclick = async()=>{
 if(!window.ethereum) return alert('Instala MetaMask');
 web3 = new Web3(window.ethereum);
 user = (await ethereum.request({method:'eth_requestAccounts'}))[0];
 document.getElementById('addr').innerText = user;
 c = new web3.eth.Contract(ABI,CONTRACT);
 loadAll();
 listenEvents();
 setInterval(loadAll,5000);
}

// ================= LOAD =================
async function loadAll(){
 const a = await c.methods.auction().call();
 document.getElementById('aucPool').innerText = web3.utils.fromWei(a.prizePool);
 document.getElementById('aucBid').innerText = web3.utils.fromWei(a.currentBid);
 countdown(a.endTime,'aucTime');

 const rh = await c.methods.raffleHourly().call();
 document.getElementById('hPool').innerText = web3.utils.fromWei(rh.prizePool);
 countdown(rh.endTime,'hTime');

 const rd = await c.methods.raffleDaily().call();
 document.getElementById('dPool').innerText = web3.utils.fromWei(rd.prizePool);
 countdown(rd.endTime,'dTime');

 document.getElementById('statAuctions').innerText = await c.methods.totalAuctions().call();
 document.getElementById('statRaffles').innerText = await c.methods.totalRaffles().call();
 document.getElementById('statBNB').innerText = web3.utils.fromWei(await c.methods.totalBNBRepartido().call());
}

// ================= BID =================
async function bid(){
 const a = await c.methods.auction().call();
 const next = web3.utils.toBN(a.currentBid).add(web3.utils.toBN(web3.utils.toWei('0.001')));
 await c.methods.bid().send({from:user,value:next});
}

// ================= EVENTS =================
function listenEvents(){
 c.events.BidPlaced({fromBlock:'latest'}).on('data',e=>{
   addBid(e.returnValues.user,e.returnValues.amount);
 });

 c.events.AuctionReward({fromBlock:'latest'}).on('data',e=>{
   addHistory(e.returnValues.user,e.returnValues.amount,e.returnValues.rank);
 });

 c.events.RaffleReward({fromBlock:'latest'}).on('data',e=>{
   const el = e.returnValues.daily ? 'dWinners':'hWinners';
   document.getElementById(el).innerHTML += `<div>${short(e.returnValues.user)} gan√≥ ${web3.utils.fromWei(e.returnValues.amount)} BNB</div>`;
 });
}

// ================= UI =================
function addBid(addr,amount){
 const val = web3.utils.fromWei(amount);
 bidListEl.innerHTML = `<div class="gold">${short(addr)} ‚Äì ${val} BNB</div>` + bidListEl.innerHTML;
}

function addHistory(addr,amount,rank){
 document.getElementById('auctionHistory').innerHTML += `<div>#${rank} ${short(addr)} ‚Üí ${web3.utils.fromWei(amount)} BNB</div>`;
}

function short(a){return a.slice(0,6)+'‚Ä¶'+a.slice(-4)}

function countdown(ts,id){
 const s = ts - Math.floor(Date.now()/1000);
 if(s<=0) return document.getElementById(id).innerText='00:00:00';
 const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;
 document.getElementById(id).innerText=`${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
}
</script>
</body>
</html>
