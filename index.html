<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BNB Universal Bank</title>

  <!-- Web3.js CDN -->
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>

  <style>
    body { background:#0b0b0f; color:#fff; font-family:Arial; padding:20px; }
    h1 { margin-bottom:20px; }
    button { padding:10px 15px; margin:5px 0; cursor:pointer; background:#1e1eff; border:none; color:white; border-radius:6px; }
    input { padding:8px; width:200px; }
    .card { background:#15151d; padding:15px; margin-top:15px; border-radius:10px; }
  </style>
</head>
<body>

<h1>üè¶ BNB Universal Bank</h1>

<button id="connectBtn">üîå Conectar Wallet</button>

<div class="card">
  <h3>üìä Stats Generales</h3>
  <p>TVL: <span id="tvl">-</span> BNB</p>
  <p>Dividend Pool: <span id="divPool">-</span> BNB</p>
  <p>Usuarios: <span id="users">-</span></p>
</div>

<div class="card">
  <h3>üë§ Mis Stats</h3>
  <p>Depositado: <span id="dep">-</span> BNB</p>
  <p>Shares: <span id="shares">-</span></p>
  <p>Pendiente: <span id="pending">-</span> BNB</p>
</div>

<div class="card">
  <h3>‚ö° Acciones</h3>
  <input id="amount" placeholder="Cantidad BNB">
  <br>
  <button id="depositBtn">Depositar</button>
  <button id="withdrawBtn">Retirar</button>
  <button id="claimBtn">Claim</button>
</div>

<script>
const CONTRACT_ADDRESS = "0x2A9C22f5b3Ccf204D1d7d11305a8F1D2FF5AbaE2";

const ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"boost","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"duration","type":"uint256"}],"name":"Boost","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Claim","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Deposit","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Loan","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RaffleEnter","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"prize","type":"uint256"}],"name":"RaffleWin","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Withdraw","type":"event"},{"inputs":[],"name":"accDividendPerShare","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"boostBP","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"activateBoost","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"dividendPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"drawRaffleWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"effectiveShares","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"enterRaffle","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"lastDividendTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastVolumeReset","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"pendingDividends","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"rafflePlayers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"rafflePot","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"takeLoan","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"totalDeposited","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalDividendsPaid","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalShares","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalWithdrawn","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"treasuryPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"users","outputs":[{"internalType":"uint256","name":"deposited","type":"uint256"},{"internalType":"uint256","name":"withdrawn","type":"uint256"},{"internalType":"uint256","name":"shares","type":"uint256"},{"internalType":"uint256","name":"rewardDebt","type":"uint256"},{"internalType":"uint256","name":"dividendsClaimed","type":"uint256"},{"internalType":"uint256","name":"lastAction","type":"uint256"},{"internalType":"uint256","name":"boostBP","type":"uint256"},{"internalType":"uint256","name":"boostEnd","type":"uint256"},{"internalType":"uint256","name":"loanAmount","type":"uint256"},{"internalType":"uint256","name":"loanEnd","type":"uint256"},{"internalType":"bool","name":"exists","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"volume24h","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];

let web3;
let contract;
let account;

const connectBtn = document.getElementById("connectBtn");
const depositBtn = document.getElementById("depositBtn");
const withdrawBtn = document.getElementById("withdrawBtn");
const claimBtn = document.getElementById("claimBtn");

connectBtn.onclick = connect;
depositBtn.onclick = deposit;
withdrawBtn.onclick = withdraw;
claimBtn.onclick = claim;

async function connect() {
  if (window.ethereum) {
    web3 = new Web3(window.ethereum);

    try {
      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      account = accounts[0];

      // comprobar que MetaMask est√° en BSC Testnet (chainId 97)
      const chainId = await ethereum.request({ method: 'eth_chainId' });
      if(chainId !== '0x61') {
        alert("Cambia MetaMask a BSC Testnet");
        return;
      }

      contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
      loadStats();
      alert("Wallet conectada: " + account);
    } catch (err) {
      alert("Error al conectar MetaMask: " + err.message);
    }
  } else {
    alert("Instala MetaMask");
  }
}

async function loadStats() {
  const tvl = await contract.methods.treasuryPool().call();
  const div = await contract.methods.dividendPool().call();
  const users = await contract.methods.totalUsers().call();

  document.getElementById("tvl").innerText = web3.utils.fromWei(tvl);
  document.getElementById("divPool").innerText = web3.utils.fromWei(div);
  document.getElementById("users").innerText = users;

  const u = await contract.methods.getUserStats(account).call();
  document.getElementById("dep").innerText = web3.utils.fromWei(u[0]);
  document.getElementById("shares").innerText = web3.utils.fromWei(u[2]);
  document.getElementById("pending").innerText = web3.utils.fromWei(u[4]);
}

async function deposit() {
  const amount = document.getElementById("amount").value;
  await contract.methods.deposit().send({ from: account, value: web3.utils.toWei(amount) });
  loadStats();
}

async function withdraw() {
  const amount = document.getElementById("amount").value;
  await contract.methods.withdraw(web3.utils.toWei(amount)).send({ from: account });
  loadStats();
}

async function claim() {
  await contract.methods.claim().send({ from: account });
  loadStats();
}
</script>

</body>
</html>
